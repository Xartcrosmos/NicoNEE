<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ESP32 Registration</title>
  <style>
    body { font-family: Arial; padding: 40px; background: #f2f2f2; }
    h1 { text-align: center; margin-bottom: 20px; }
    form { max-width: 400px; margin: auto; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input { width: 100%; padding: 10px; margin: 10px 0; border-radius: 4px; border: 1px solid #ccc; }
    button { width: 100%; padding: 12px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #45a049; }
    #message { text-align: center; margin-top: 15px; font-weight: bold; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
</head>
<body>

<h1>ESP32 Registration</h1>
<form id="registrationForm">
  <input type="text" id="name" placeholder="Full Name" required>
  <input type="tel" id="contact" placeholder="Contact Number" required>
  <button type="submit">Submit</button>
</form>
<div id="message"></div>

<script>
const supabaseUrl = "https://qkswuqrgtbfcdywzuxtk.supabase.co";
const supabaseKey = "YOUR_ANON_PUBLIC_KEY";
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

const form = document.getElementById('registrationForm');
const message = document.getElementById('message');

form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const name = document.getElementById('name').value.trim();
  const contact = document.getElementById('contact').value.trim();

  if (!name || !contact) {
    message.style.color = 'red';
    message.textContent = 'Please fill in all fields.';
    return;
  }

  // Show fingerprint prompt first
  message.style.color = 'blue';
  message.textContent = 'Please scan your finger on the ESP32 to complete registration...';

  // Send request to ESP32 to start fingerprint scan
  try {
    const response = await fetch('http://YOUR_ESP32_IP/fingerprint', { method: 'POST', body: JSON.stringify({ name, contact }) });
    const result = await response.json();

    if (result.success) {
      message.style.color = 'green';
      message.textContent = 'Fingerprint scanned! Registration complete.';
    } else {
      message.style.color = 'red';
      message.textContent = 'Fingerprint scan failed. Try again.';
    }
  } catch (err) {
    message.style.color = 'red';
    message.textContent = 'ESP32 not reachable. Check your network.';
  }

  form.reset();
});
</script>

</body>
</html>
